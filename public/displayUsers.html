<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User List</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h2 class="mb-4">User Details</h2>

        <!-- Add User Button -->
        <div class="text-right mb-3">
            <button onclick="redirectToAddUser()" class="btn btn-primary">Add User</button>
        </div>

        <table class="table table-bordered">
            <thead class="thead-light">
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Gender</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="userTable"></tbody>
        </table>
    </div>

    <script>
        // Redirect to addUser.html when Add User button is clicked
        function redirectToAddUser() {
            window.location.href = 'addUser.html';
        }

        async function loadUsers() {
            try {
                const response = await fetch('/api/users/getAllUsers');
                const users = await response.json();
                const userTable = document.getElementById('userTable');
                userTable.innerHTML = '';
                users.forEach(user => {
                    const row = `<tr>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.gender}</td>
                        <td>${user.status}</td>
                        <td>
                            <i class="fas fa-edit" onclick="editUser('${user._id}')" style="cursor:pointer; margin-right: 10px;"></i>
                            <i class="fas fa-trash-alt" onclick="deleteUser('${user._id}')" style="cursor:pointer; color:red;"></i>
                        </td>
                    </tr>`;
                    userTable.innerHTML += row;
                });
            } catch (error) {
                console.error("Failed to load users:", error);
            }
        }

        async function deleteUser(id) {
            if (confirm('Are you sure you want to delete this user?')) {
                try {
                    const response = await fetch(`/api/users/deleteUser/${id}`, { method: 'DELETE' });
                    const result = await response.json();
                    alert(result.message);
                    loadUsers();
                } catch (error) {
                    console.error("Error deleting user:", error);
                }
            }
        }

        function editUser(id) {
            window.location.href = `updateUser.html?id=${id}`;
        }

        window.onload = loadUsers;
    </script>

    <!-- Bootstrap JS and dependencies (optional) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
